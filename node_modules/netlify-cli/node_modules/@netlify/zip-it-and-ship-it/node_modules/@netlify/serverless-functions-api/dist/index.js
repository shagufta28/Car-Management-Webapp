import{createRequire}from"module";const require=createRequire(import.meta.url);
import{fileURLToPath as Yt}from"url";import{Buffer as jt}from"node:buffer";import{version as Mt}from"node:process";import{pipeline as Bt,Readable as Gt}from"node:stream";import{promisify as Vt}from"node:util";var Z=e=>({id:e??""});var ee="x-nf-client-connection-ip",te="x-nf-geo",re="x-nf-account-id",j="x-nf-deploy-id",ne="x-nf-deploy-context",se="x-nf-deploy-published",ie="x-nf-site-id",oe="x-nf-request-flags",z="x-nf-invocation-metadata",ae="x-nf-request-id",ce="x-nf-function-timing",ue=e=>{let t=new Headers;return Object.entries(e).forEach(([r,n])=>{n!==void 0&&t.set(r.toLowerCase(),n)}),t},fe=e=>{let t={};for(let[r,n]of e.entries())r in t?t[r].push(n):t[r]=[n];return t};var he=e=>({context:e.get(ne)??"",id:e.get(j)??"",published:e.get(se)==="1"});import{Buffer as Xe}from"buffer";var B=Symbol("Request flags"),N=Symbol("Request route"),Ye=typeof Request>"u"?class{}:Request,le,M=class extends(le=Ye,B,N,le){},pe=(e,t)=>{if(!(e==null||e===""))return t?Xe.from(e,"base64"):e};var O=class{#e;#t;constructor(t){this.#e=new Set,this.#t=t}get(t){let r=this.#t[t];return r!==void 0&&this.#e.add(t),r}get evaluations(){return this.#e}},me=e=>e[B]??new O({}),de=(e,t)=>{e[B]=t};import{Buffer as Qe}from"node:buffer";var ge=e=>{if(e===null)return{};try{return JSON.parse(Qe.from(e,"base64").toString("utf-8"))}catch{return{}}};var xe=e=>e??"";var H=class{constructor(e,t,r,n,i,u){this.type=3,this.name="",this.prefix="",this.value="",this.suffix="",this.modifier=3,this.type=e,this.name=t,this.prefix=r,this.value=n,this.suffix=i,this.modifier=u}hasCustomName(){return this.name!==""&&typeof this.name!="number"}},Ze=/[$_\p{ID_Start}]/u,et=/[$_\u200C\u200D\p{ID_Continue}]/u,K=".*";function tt(e,t){return(t?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(e)}function we(e,t=!1){let r=[],n=0;for(;n<e.length;){let i=e[n],u=function(o){if(!t)throw new TypeError(o);r.push({type:"INVALID_CHAR",index:n,value:e[n++]})};if(i==="*"){r.push({type:"ASTERISK",index:n,value:e[n++]});continue}if(i==="+"||i==="?"){r.push({type:"OTHER_MODIFIER",index:n,value:e[n++]});continue}if(i==="\\"){r.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});continue}if(i==="{"){r.push({type:"OPEN",index:n,value:e[n++]});continue}if(i==="}"){r.push({type:"CLOSE",index:n,value:e[n++]});continue}if(i===":"){let o="",s=n+1;for(;s<e.length;){let c=e.substr(s,1);if(s===n+1&&Ze.test(c)||s!==n+1&&et.test(c)){o+=e[s++];continue}break}if(!o){u(`Missing parameter name at ${n}`);continue}r.push({type:"NAME",index:n,value:o}),n=s;continue}if(i==="("){let o=1,s="",c=n+1,a=!1;if(e[c]==="?"){u(`Pattern cannot start with "?" at ${c}`);continue}for(;c<e.length;){if(!tt(e[c],!1)){u(`Invalid character '${e[c]}' at ${c}.`),a=!0;break}if(e[c]==="\\"){s+=e[c++]+e[c++];continue}if(e[c]===")"){if(o--,o===0){c++;break}}else if(e[c]==="("&&(o++,e[c+1]!=="?")){u(`Capturing groups are not allowed at ${c}`),a=!0;break}s+=e[c++]}if(a)continue;if(o){u(`Unbalanced pattern at ${n}`);continue}if(!s){u(`Missing pattern at ${n}`);continue}r.push({type:"REGEX",index:n,value:s}),n=c;continue}r.push({type:"CHAR",index:n,value:e[n++]})}return r.push({type:"END",index:n,value:""}),r}function Ce(e,t={}){let r=we(e);t.delimiter??(t.delimiter="/#?"),t.prefixes??(t.prefixes="./");let n=`[^${x(t.delimiter)}]+?`,i=[],u=0,o=0,s="",c=new Set,a=f=>{if(o<r.length&&r[o].type===f)return r[o++].value},l=()=>a("OTHER_MODIFIER")??a("ASTERISK"),g=f=>{let h=a(f);if(h!==void 0)return h;let{type:m,index:k}=r[o];throw new TypeError(`Unexpected ${m} at ${k}, expected ${f}`)},C=()=>{let f="",h;for(;h=a("CHAR")??a("ESCAPED_CHAR");)f+=h;return f},v=f=>f,I=t.encodePart||v,T="",_=f=>{T+=f},b=()=>{T.length&&(i.push(new H(3,"","",I(T),"",3)),T="")},A=(f,h,m,k,S)=>{let p=3;switch(S){case"?":p=1;break;case"*":p=0;break;case"+":p=2;break}if(!h&&!m&&p===3){_(f);return}if(b(),!h&&!m){if(!f)return;i.push(new H(3,"","",I(f),"",p));return}let d;m?m==="*"?d=K:d=m:d=n;let y=2;d===n?(y=1,d=""):d===K&&(y=0,d="");let w;if(h?w=h:m&&(w=u++),c.has(w))throw new TypeError(`Duplicate name '${w}'.`);c.add(w),i.push(new H(y,w,I(f),d,I(k),p))};for(;o<r.length;){let f=a("CHAR"),h=a("NAME"),m=a("REGEX");if(!h&&!m&&(m=a("ASTERISK")),h||m){let p=f??"";t.prefixes.indexOf(p)===-1&&(_(p),p=""),b();let d=l();A(p,h,m,"",d);continue}let k=f??a("ESCAPED_CHAR");if(k){_(k);continue}if(a("OPEN")){let p=C(),d=a("NAME"),y=a("REGEX");!d&&!y&&(y=a("ASTERISK"));let w=C();g("CLOSE");let F=l();A(p,d,y,w,F);continue}b(),g("END")}return i}function x(e){return e.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Se(e){return e&&e.ignoreCase?"ui":"u"}function rt(e,t,r){return be(Ce(e,r),t,r)}function $(e){switch(e){case 0:return"*";case 1:return"?";case 2:return"+";case 3:return""}}function be(e,t,r={}){r.delimiter??(r.delimiter="/#?"),r.prefixes??(r.prefixes="./"),r.sensitive??(r.sensitive=!1),r.strict??(r.strict=!1),r.end??(r.end=!0),r.start??(r.start=!0),r.endsWith="";let n=r.start?"^":"";for(let s of e){if(s.type===3){s.modifier===3?n+=x(s.value):n+=`(?:${x(s.value)})${$(s.modifier)}`;continue}t&&t.push(s.name);let c=`[^${x(r.delimiter)}]+?`,a=s.value;if(s.type===1?a=c:s.type===0&&(a=K),!s.prefix.length&&!s.suffix.length){s.modifier===3||s.modifier===1?n+=`(${a})${$(s.modifier)}`:n+=`((?:${a})${$(s.modifier)})`;continue}if(s.modifier===3||s.modifier===1){n+=`(?:${x(s.prefix)}(${a})${x(s.suffix)})`,n+=$(s.modifier);continue}n+=`(?:${x(s.prefix)}`,n+=`((?:${a})(?:`,n+=x(s.suffix),n+=x(s.prefix),n+=`(?:${a}))*)${x(s.suffix)})`,s.modifier===0&&(n+="?")}let i=`[${x(r.endsWith)}]|$`,u=`[${x(r.delimiter)}]`;if(r.end)return r.strict||(n+=`${u}?`),r.endsWith.length?n+=`(?=${i})`:n+="$",new RegExp(n,Se(r));r.strict||(n+=`(?:${u}(?=${i}))?`);let o=!1;if(e.length){let s=e[e.length-1];s.type===3&&s.modifier===3&&(o=r.delimiter.indexOf(s)>-1)}return o||(n+=`(?=${u}|${i})`),new RegExp(n,Se(r))}var P={delimiter:"",prefixes:"",sensitive:!0,strict:!0},nt={delimiter:".",prefixes:"",sensitive:!0,strict:!0},st={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function it(e,t){return e.length?e[0]==="/"?!0:!t||e.length<2?!1:(e[0]=="\\"||e[0]=="{")&&e[1]=="/":!1}function ke(e,t){return e.startsWith(t)?e.substring(t.length,e.length):e}function ot(e,t){return e.endsWith(t)?e.substr(0,e.length-t.length):e}function Re(e){return!e||e.length<2?!1:e[0]==="["||(e[0]==="\\"||e[0]==="{")&&e[1]==="["}var ve=["ftp","file","http","https","ws","wss"];function Ie(e){if(!e)return!0;for(let t of ve)if(e.test(t))return!0;return!1}function at(e,t){if(e=ke(e,"#"),t||e==="")return e;let r=new URL("https://example.com");return r.hash=e,r.hash?r.hash.substring(1,r.hash.length):""}function ct(e,t){if(e=ke(e,"?"),t||e==="")return e;let r=new URL("https://example.com");return r.search=e,r.search?r.search.substring(1,r.search.length):""}function ut(e,t){return t||e===""?e:Re(e)?Le(e):Pe(e)}function ft(e,t){if(t||e==="")return e;let r=new URL("https://example.com");return r.password=e,r.password}function ht(e,t){if(t||e==="")return e;let r=new URL("https://example.com");return r.username=e,r.username}function lt(e,t,r){if(r||e==="")return e;if(t&&!ve.includes(t))return new URL(`${t}:${e}`).pathname;let n=e[0]=="/";return e=new URL(n?e:"/-"+e,"https://example.com").pathname,n||(e=e.substring(2,e.length)),e}function pt(e,t,r){return Ee(t)===e&&(e=""),r||e===""?e:Te(e)}function mt(e,t){return e=ot(e,":"),t||e===""?e:X(e)}function Ee(e){switch(e){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function X(e){if(e==="")return e;if(/^[-+.A-Za-z0-9]*$/.test(e))return e.toLowerCase();throw new TypeError(`Invalid protocol '${e}'.`)}function dt(e){if(e==="")return e;let t=new URL("https://example.com");return t.username=e,t.username}function gt(e){if(e==="")return e;let t=new URL("https://example.com");return t.password=e,t.password}function Pe(e){if(e==="")return e;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(e))throw new TypeError(`Invalid hostname '${e}'`);let t=new URL("https://example.com");return t.hostname=e,t.hostname}function Le(e){if(e==="")return e;if(/[^0-9a-fA-F[\]:]/g.test(e))throw new TypeError(`Invalid IPv6 hostname '${e}'`);return e.toLowerCase()}function Te(e){if(e===""||/^[0-9]*$/.test(e)&&parseInt(e)<=65535)return e;throw new TypeError(`Invalid port '${e}'.`)}function xt(e){if(e==="")return e;let t=new URL("https://example.com");return t.pathname=e[0]!=="/"?"/-"+e:e,e[0]!=="/"?t.pathname.substring(2,t.pathname.length):t.pathname}function St(e){return e===""?e:new URL(`data:${e}`).pathname}function yt(e){if(e==="")return e;let t=new URL("https://example.com");return t.search=e,t.search.substring(1,t.search.length)}function wt(e){if(e==="")return e;let t=new URL("https://example.com");return t.hash=e,t.hash.substring(1,t.hash.length)}var Ct=class{constructor(e){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=e}get result(){return this.internalResult}parse(){for(this.tokenList=we(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===0){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}else if(this.state===2){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0)if(this.isGroupClose())this.groupDepth-=1;else continue;if(this.isGroupOpen()){this.groupDepth+=1;continue}switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let e=7,t=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(e=2,t=3):this.shouldTreatAsStandardURL&&(e=2),this.changeState(e,t)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1);break;case 9:break;case 10:break}}}changeState(e,t){switch(this.state){case 0:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 2:break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString();break;case 10:break}this.changeStateWithoutSettingComponent(e,t)}changeStateWithoutSettingComponent(e,t){this.state=e,this.componentStart=this.tokenIndex+t,this.tokenIndex+=t,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(e){this.rewind(),this.state=e}safeToken(e){return e<0&&(e=this.tokenList.length-e),e<this.tokenList.length?this.tokenList[e]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(e,t){let r=this.safeToken(e);return r.value===t&&(r.type==="CHAR"||r.type==="ESCAPED_CHAR"||r.type==="INVALID_CHAR")}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;let e=this.safeToken(this.tokenIndex-1);return e.type!=="NAME"&&e.type!=="REGEX"&&e.type!=="CLOSE"&&e.type!=="ASTERISK"}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return this.tokenList[this.tokenIndex].type=="OPEN"}isGroupClose(){return this.tokenList[this.tokenIndex].type=="CLOSE"}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){let e=this.tokenList[this.tokenIndex],t=this.safeToken(this.componentStart).index;return this.input.substring(t,e.index)}computeShouldTreatAsStandardURL(){let e={};Object.assign(e,P),e.encodePart=X;let t=rt(this.makeComponentString(),void 0,e);this.shouldTreatAsStandardURL=Ie(t)}},J=["protocol","username","password","hostname","port","pathname","search","hash"],E="*";function ye(e,t){if(typeof e!="string")throw new TypeError("parameter 1 is not of type 'string'.");let r=new URL(e,t);return{protocol:r.protocol.substring(0,r.protocol.length-1),username:r.username,password:r.password,hostname:r.hostname,port:r.port,pathname:r.pathname,search:r.search!==""?r.search.substring(1,r.search.length):void 0,hash:r.hash!==""?r.hash.substring(1,r.hash.length):void 0}}function R(e,t){return t?U(e):e}function D(e,t,r){let n;if(typeof t.baseURL=="string")try{n=new URL(t.baseURL),e.protocol=R(n.protocol.substring(0,n.protocol.length-1),r),e.username=R(n.username,r),e.password=R(n.password,r),e.hostname=R(n.hostname,r),e.port=R(n.port,r),e.pathname=R(n.pathname,r),e.search=R(n.search.substring(1,n.search.length),r),e.hash=R(n.hash.substring(1,n.hash.length),r)}catch{throw new TypeError(`invalid baseURL '${t.baseURL}'.`)}if(typeof t.protocol=="string"&&(e.protocol=mt(t.protocol,r)),typeof t.username=="string"&&(e.username=ht(t.username,r)),typeof t.password=="string"&&(e.password=ft(t.password,r)),typeof t.hostname=="string"&&(e.hostname=ut(t.hostname,r)),typeof t.port=="string"&&(e.port=pt(t.port,e.protocol,r)),typeof t.pathname=="string"){if(e.pathname=t.pathname,n&&!it(e.pathname,r)){let i=n.pathname.lastIndexOf("/");i>=0&&(e.pathname=R(n.pathname.substring(0,i+1),r)+e.pathname)}e.pathname=lt(e.pathname,e.protocol,r)}return typeof t.search=="string"&&(e.search=ct(t.search,r)),typeof t.hash=="string"&&(e.hash=at(t.hash,r)),e}function U(e){return e.replace(/([+*?:{}()\\])/g,"\\$1")}function bt(e){return e.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function kt(e,t){t.delimiter??(t.delimiter="/#?"),t.prefixes??(t.prefixes="./"),t.sensitive??(t.sensitive=!1),t.strict??(t.strict=!1),t.end??(t.end=!0),t.start??(t.start=!0),t.endsWith="";let r=".*",n=`[^${bt(t.delimiter)}]+?`,i=/[$_\u200C\u200D\p{ID_Continue}]/u,u="";for(let o=0;o<e.length;++o){let s=e[o];if(s.type===3){if(s.modifier===3){u+=U(s.value);continue}u+=`{${U(s.value)}}${$(s.modifier)}`;continue}let c=s.hasCustomName(),a=!!s.suffix.length||!!s.prefix.length&&(s.prefix.length!==1||!t.prefixes.includes(s.prefix)),l=o>0?e[o-1]:null,g=o<e.length-1?e[o+1]:null;if(!a&&c&&s.type===1&&s.modifier===3&&g&&!g.prefix.length&&!g.suffix.length)if(g.type===3){let C=g.value.length>0?g.value[0]:"";a=i.test(C)}else a=!g.hasCustomName();if(!a&&!s.prefix.length&&l&&l.type===3){let C=l.value[l.value.length-1];a=t.prefixes.includes(C)}a&&(u+="{"),u+=U(s.prefix),c&&(u+=`:${s.name}`),s.type===2?u+=`(${s.value})`:s.type===1?c||(u+=`(${n})`):s.type===0&&(!c&&(!l||l.type===3||l.modifier!==3||a||s.prefix!=="")?u+="*":u+=`(${r})`),s.type===1&&c&&s.suffix.length&&i.test(s.suffix[0])&&(u+="\\"),u+=U(s.suffix),a&&(u+="}"),s.modifier!==3&&(u+=$(s.modifier))}return u}var G=class{constructor(e={},t,r){this.regexp={},this.names={},this.component_pattern={},this.parts={};try{let n;if(typeof t=="string"?n=t:r=t,typeof e=="string"){let s=new Ct(e);if(s.parse(),e=s.result,n===void 0&&typeof e.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.");e.baseURL=n}else{if(!e||typeof e!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");if(n)throw new TypeError("parameter 1 is not of type 'string'.")}typeof r>"u"&&(r={ignoreCase:!1});let i={ignoreCase:r.ignoreCase===!0},u={pathname:E,protocol:E,username:E,password:E,hostname:E,port:E,search:E,hash:E};this.pattern=D(u,e,!0),Ee(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");let o;for(o of J){if(!(o in this.pattern))continue;let s={},c=this.pattern[o];switch(this.names[o]=[],o){case"protocol":Object.assign(s,P),s.encodePart=X;break;case"username":Object.assign(s,P),s.encodePart=dt;break;case"password":Object.assign(s,P),s.encodePart=gt;break;case"hostname":Object.assign(s,nt),Re(c)?s.encodePart=Le:s.encodePart=Pe;break;case"port":Object.assign(s,P),s.encodePart=Te;break;case"pathname":Ie(this.regexp.protocol)?(Object.assign(s,st,i),s.encodePart=xt):(Object.assign(s,P,i),s.encodePart=St);break;case"search":Object.assign(s,P,i),s.encodePart=yt;break;case"hash":Object.assign(s,P,i),s.encodePart=wt;break}try{this.parts[o]=Ce(c,s),this.regexp[o]=be(this.parts[o],this.names[o],s),this.component_pattern[o]=kt(this.parts[o],s)}catch{throw new TypeError(`invalid ${o} pattern '${this.pattern[o]}'.`)}}}catch(n){throw new TypeError(`Failed to construct 'URLPattern': ${n.message}`)}}test(e={},t){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof e!="string"&&t)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof e>"u")return!1;try{typeof e=="object"?r=D(r,e,!1):r=D(r,ye(e,t),!1)}catch{return!1}let n;for(n of J)if(!this.regexp[n].exec(r[n]))return!1;return!0}exec(e={},t){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof e!="string"&&t)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof e>"u")return;try{typeof e=="object"?r=D(r,e,!1):r=D(r,ye(e,t),!1)}catch{return null}let n={};t?n.inputs=[e,t]:n.inputs=[e];let i;for(i of J){let u=this.regexp[i].exec(r[i]);if(!u)return null;let o={};for(let[s,c]of this.names[i].entries())if(typeof c=="string"||typeof c=="number"){let a=u[s+1];o[c]=a}n[i]={input:r[i]??"",groups:o}}return n}static compareComponent(e,t,r){let n=(s,c)=>{for(let a of["type","modifier","prefix","value","suffix"]){if(s[a]<c[a])return-1;if(s[a]===c[a])continue;return 1}return 0},i=new H(3,"","","","",3),u=new H(0,"","","","",3),o=(s,c)=>{let a=0;for(;a<Math.min(s.length,c.length);++a){let l=n(s[a],c[a]);if(l)return l}return s.length===c.length?0:n(s[a]??i,c[a]??i)};return!t.component_pattern[e]&&!r.component_pattern[e]?0:t.component_pattern[e]&&!r.component_pattern[e]?o(t.parts[e],[u]):!t.component_pattern[e]&&r.component_pattern[e]?o([u],r.parts[e]):o(t.parts[e],r.parts[e])}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}};globalThis.URLPattern||(globalThis.URLPattern=G);var Ne=(e,t)=>{var o;if(e===void 0)return{};let r=t.endsWith("/")?t.slice(0,-1):t,i=(o=new G({pathname:e,baseURL:r}).exec(r))==null?void 0:o.pathname.groups;return i?Object.entries(i).reduce((s,[c,a])=>a===void 0?s:{...s,[c]:a},{}):{}};var $e=e=>e??"";import{env as Rt}from"process";var _e=()=>({region:Rt.AWS_REGION});import{env as Y}from"process";var Ae=()=>({id:Y.SITE_ID,name:Y.SITE_NAME,url:Y.URL});var vt=e=>{let t=JSON.stringify(e);return new Response(t,{headers:{"content-type":"application/json"}})},Fe=(e,t)=>{let r={};try{r=Ne(e[N],e.url)}catch{console.log(`Could not parse function route ${e[N]}.`)}return{account:Z(e.headers.get(re)),cookies:t.getPublicInterface(),deploy:he(e.headers),flags:me(e),geo:ge(e.headers.get(te)),ip:xe(e.headers.get(ee)),json:vt,log:console.log,next:()=>{throw new Error("`context.next` is not implemented for serverless functions")},params:r,requestId:$e(e.headers.get(ae)),rewrite:i=>{let u=It(i,e.url);return Et(u)},server:_e(),site:Ae()}},It=(e,t)=>{if(e instanceof URL)return e;if(e.startsWith("/")){let r=new URL(t);return r.pathname=e,r}return new URL(e)},Et=async e=>await fetch(e);import De from"node:assert";function Oe(e){function t(a,l=2){return a.padStart(l,"0")}let r=t(e.getUTCDate().toString()),n=t(e.getUTCHours().toString()),i=t(e.getUTCMinutes().toString()),u=t(e.getUTCSeconds().toString()),o=e.getUTCFullYear(),s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${s[e.getUTCDay()]}, ${r} ${c[e.getUTCMonth()]} ${o} ${n}:${i}:${u} GMT`}var Pt=/^(?=[\u0020-\u007E]*$)[^()@<>,;:\\"[\]?={}\s]+$/;function Lt(e){if(!e.name)return"";let t=[];if(Tt(e.name),$t(e.name,e.value),t.push(`${e.name}=${e.value}`),e.name.startsWith("__Secure")&&(e.secure=!0),e.name.startsWith("__Host")&&(e.path="/",e.secure=!0,delete e.domain),e.secure&&t.push("Secure"),e.httpOnly&&t.push("HttpOnly"),typeof e.maxAge=="number"&&Number.isInteger(e.maxAge)&&(De(e.maxAge>=0,"Max-Age must be an integer superior or equal to 0"),t.push(`Max-Age=${e.maxAge}`)),e.domain&&(_t(e.domain),t.push(`Domain=${e.domain}`)),e.sameSite&&t.push(`SameSite=${e.sameSite}`),e.path&&(Nt(e.path),t.push(`Path=${e.path}`)),e.expires){let{expires:r}=e,n=Oe(typeof r=="number"?new Date(r):r);t.push(`Expires=${n}`)}return e.unparsed&&t.push(e.unparsed.join("; ")),t.join("; ")}function Tt(e){if(e&&!Pt.test(e))throw new TypeError(`Invalid cookie name: "${e}".`)}function Nt(e){if(e!=null)for(let t=0;t<e.length;t++){let r=e.charAt(t);if(r<" "||r>"~"||r==";")throw new Error(`${e}: Invalid cookie path char '${r}'`)}}function $t(e,t){if(!(t==null||e==null))for(let r=0;r<t.length;r++){let n=t.charAt(r);if(n<"!"||n=='"'||n==","||n==";"||n=="\\"||n=="\x7F")throw new Error(`RFC2616 cookie '${e}' cannot contain character '${n}'`);if(n>"\x80")throw new Error(`RFC2616 cookie '${e}' can only have US-ASCII chars as value${n.charCodeAt(0).toString(16)}`)}}function _t(e){if(e==null)return;let t=e.charAt(0),r=e.charAt(e.length-1);if(t=="-"||r=="."||r=="-")throw new Error(`Invalid first/last char in cookie domain: ${e}`)}function Ue(e){let t=e.get("Cookie");if(t!=null){let r={},n=t.split(";");for(let i of n){let[u,...o]=i.split("=");De(u!=null);let s=u.trim();r[s]=o.join("=")}return r}return{}}function Q(e,t){let r=Lt(t);r&&e.append("Set-Cookie",r)}function He(e,t,r){Q(e,Object.assign({name:t,value:"",expires:new Date(0)},r))}var V=class{constructor(t){this.ops=[],this.request=t}apply(t){this.ops.forEach(r=>{switch(r.type){case"delete":He(t.headers,r.options.name,{domain:r.options.domain,path:r.options.path});break;case"set":Q(t.headers,r.cookie);break;default:}})}delete(t){let r={path:"/"},n=typeof t=="string"?{name:t}:t;this.ops.push({options:{...r,...n},type:"delete"})}get(t){return Ue(this.request.headers)[t]}getPublicInterface(){return{delete:this.delete.bind(this),get:this.get.bind(this),set:this.set.bind(this)}}set(t,r){let n;if(typeof t=="string"){if(typeof r!="string")throw new TypeError("You must provide the cookie value as a string to 'cookies.set'");n={name:t,value:r}}else n=t;this.ops.push({cookie:n,type:"set"})}};import{Buffer as qe}from"node:buffer";import je from"node:process";var At="NETLIFY_PURGE_API_TOKEN",Ft="NETLIFY_BLOBS_CONTEXT",Me=(e,t,r)=>{var u,o;let{blobs:n}=t,i=(o=(u=r==null?void 0:r.clientContext)==null?void 0:u.custom)==null?void 0:o.purge_api_token;if(typeof n=="string"&&n!=="")try{let s=qe.from(n,"base64").toString("utf8"),c=JSON.parse(s),a=e.get(ie),l=e.get(j);je.env[Ft]=qe.from(JSON.stringify({edgeURL:c.url,uncachedEdgeURL:c.url_uncached,token:c.token,siteID:a,deployID:l,primaryRegion:c.primary_region})).toString("base64")}catch(s){console.error("An internal error occurred while setting up Netlify Blobs:",s)}typeof i=="string"&&i!==""&&(je.env[At]=i)};var W=class e extends Error{constructor(t){super(t),this.name="NetlifyUserError",Object.setPrototypeOf(this,e.prototype)}};import Ut from"node:http";import Ht from"node:https";import{AsyncLocalStorage as Ot}from"node:async_hooks";var L=new Ot;import{env as Dt}from"node:process";var Be=(e,t)=>{Dt.NETLIFY_DEV||console.log("__nfSystemLog",{msg:e,fields:t})};var qt=globalThis.fetch,Ge=!1,Ve=e=>{let t=L.getStore();if(t!=null&&t.cdnLoopHeader){if(e.headersSent){Be("Headers already sent, cannot add CDN-Loop header");return}e.setHeader("CDN-Loop",t==null?void 0:t.cdnLoopHeader)}},We=()=>{if(!Ge){Ge=!0,globalThis.fetch=function(t,r){let n=new Request(t,r),i=L.getStore();return i!=null&&i.cdnLoopHeader&&n.headers.set("CDN-Loop",i.cdnLoopHeader),qt(n)};for(let e of[Ut,Ht]){let t=e.request;e.get=function(...n){let i=t(...n);return Ve(i),i.end(),i},e.request=function(...n){let i=t(...n);return Ve(i),i}}}};var Wt=Vt(Bt),zt=20,ze=0,Jt=e=>awslambda.streamifyResponse(async(t,r,n)=>{let i=Date.now(),u;t.initStartTimestamp!==void 0&&(u=ze===0?i-t.initStartTimestamp:0),ze=i;let{body:o,httpMethod:s,flags:c,isBase64Encoded:a,headers:l,rawUrl:g,route:C}=t,v=new O(c||{}),I=ue(l),T=pe(o,a),_=v.get("serverless_functions_abort_signal")===!0?AbortSignal.timeout(n.getRemainingTimeInMillis()-zt):void 0,b=new M(g,{body:T,headers:I,method:s,signal:_});Me(I,t,n),de(b,v),C&&(b[N]=C),v.get("serverless_functions_request_interceptor_v2")===!0&&We(),v.get("serverless_functions_wait_event_loop")===!0&&(n.callbackWaitsForEmptyEventLoop=!1);let A=new V(b),f=Fe(b,A),h=await L.run({cdnLoopHeader:I.get("cdn-loop"),context:f},()=>e.default(b,f)),m={version:Mt},k=jt.from(JSON.stringify(m)).toString("base64");if(h instanceof Response){A.apply(h);let S=new Headers(h.headers),{body:p,status:d}=h,y=v.evaluations;y.size!==0&&S.set(oe,[...y].join(",")),S.set(z,k),u!==void 0&&S.set(ce,`init;dur=${u}`);let w={multiValueHeaders:fe(S),statusCode:d},F=awslambda.HttpResponseStream.from(r,w);if((v.get("serverless_functions_fix_empty_body")===!0||p===null)&&F.write(""),p===null){F.end();return}let Ke=Gt.fromWeb(p);await Wt(Ke,F);return}if(h===void 0){let S=awslambda.HttpResponseStream.from(r,{statusCode:204,headers:{[z]:k}});S.write(""),S.end();return}throw new W("Function returned an unsupported value. Accepted types are 'Response' or 'undefined'")});import q from"process";var Kt={delete:e=>{delete q.env[e]},get:e=>q.env[e],has:e=>!!q.env[e],set:(e,t)=>{q.env[e]=t},toObject:()=>Object.entries(q.env).reduce((e,[t,r])=>r===void 0?e:{...e,[t]:r},{})},Je={get context(){let e=L.getStore();return(e==null?void 0:e.context)??null},env:Kt};globalThis.Netlify=Je;var Xt=()=>Je;var In=()=>Yt(import.meta.url);export{Jt as getLambdaHandler,Xt as getNetlifyGlobal,In as getPath};
